<%= form_with theme: 'modal', model: @payment, url: { controller: 'scan_payments', action: 'create' }, id: 'create_scan', data: { controller: 'total' } do |f| %>
  <%= render 'modal_header' %>
  <section class="modal-card-body">
    <%= f.hidden_field :type %>
    <%= f.fields :payment_orders do |ef| %>
      <div class="field-label is-normal">
        <% if f.object.payment_orders.size > 1 %>
          <span class="text-grey">第 <%= ef.index + 1 %> 次下单金额</span>
        <% else %>
          <span class="text-grey">下单金额</span>
        <% end %>
        <span><%= ef.object.order_amount.to_money.format.html_safe %></span>
      </div>
      <%= ef.hidden_field :order_amount %>
      <%= ef.hidden_field :state %>
      <%= ef.hidden_field :order_id %>
    <% end %>
    <%= f.number_field :adjust_amount, data: { total_target: 'reduce', action: 'total#updateReduce' } %>
    <%= f.number_field :total_amount, data: { total_target: 'total', action: 'total#updateTotal' } %>
  </section>
  <footer class="modal-card-foot">
    <div
      data-controller="scan"
      data-scan-form-value="create_scan"
      data-action="click->scan#report"
      class="button is-medium is-primary"
    >
      <%= svg_tag 'credit-card' %>
      <span class="ml-1"><%= t('.scan_payments.create.title') %></span>
    </div>
  </footer>
<% end %>
